<!DOCTYPE html>
<html lang="en">
<head>
    <title>Stop leaking secrets: a guide to secure environment management with Vesper's env.lua - Vesper.sh</title>
    <meta name="description" content="A practical guide on how to use Vesper's env.lua to securely load API keys and other secrets into your shell environment, without ever exposing them in your shell history or dotfiles.">
    <!-- ... all other meta tags, including page-specific OG tags ... -->
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <nav class="main-nav"><!-- ... full nav code with corrected paths ... --></nav>
    <div class="overlay-menu"><!-- ... full overlay code with corrected paths ... --></div>

    <main class="container">
        <article>
            <header>
                <h1>Stop leaking secrets: a guide to secure environment management with Vesper's `env.lua`</h1>
                <p class="post-meta">Posted on December 6, 2025 by The Vesper Team</p>
            </header>
            
            <p>We've all done it. You quickly run <code>export MY_API_KEY="supersecret..."</code> in your shell to test something, and then you realize you've just saved a sensitive credential to your shell's history file in plain text. Or you commit a <code>.env</code> file by accident. Managing secrets is a hard problem. Vesper offers a powerful and elegant solution: **startup-loaded environment scripting**.</p>
            <p>In this guide, we'll show you how to use a simple <code>env.lua</code> script to securely load secrets into your Vesper panes automatically, keeping them out of your shell history and your git repository.</p>

            <h2>The goal: secure, automated, context-aware secrets</h2>
            <p>Our goal is to create a system where the right API keys are automatically available in the right projects, without ever being typed manually into the shell. We will store our secrets in a plain text file, but we will use <code>.gitignore</code> to ensure it's never committed, and Vesper's `env.lua` script will be the intelligent bridge.</p>

            <h2>Step 1: create your secrets file</h2>
            <p>In your project directory, create a simple file named <code>.tokens</code>. This file will hold your secrets, one per line.</p>
            <div class="code-block">
                <pre><code># Inside my-project/.tokens
GITHUB_API_KEY=ghp_123456789abcdefgh
STRIPE_API_KEY=sk_test_987654321fedcba</code></pre>
                <button class="copy-button">Copy</button>
            </div>
            <p>Now, the most important step: add this file to your project's <code>.gitignore</code> file to ensure it's never committed.</p>
            <pre><code># Inside .gitignore
.tokens</code></pre>

            <h2>Step 2: create your intelligent `env.lua` script</h2>
            <p>This is where the magic happens. In your Vesper configuration directory (<code>~/.config/vesper/</code>), create a file named <code>env.lua</code>. Vesper will run this script **once at startup**. We will write some simple Lua code to check for our <code>.tokens</code> file and load its contents.</p>

            <div class="code-block">
                <pre><code>-- Inside ~/.config/vesper/env.lua
local env = {}
local token_file_path = vim.fn.getcwd() .. "/.tokens"
local file = io.open(token_file_path, "r")

if file then
  for line in file:lines() do
    local key, value = line:match("([^=]+)=(.*)")
    if key and value then
      env[key] = value
    end
  end
  file:close()
end

return env</code></pre>
                <button class="copy-button">Copy</button>
            </div>
            
            <p><strong>How it works:</strong> This script gets the current working directory, checks if a <code>.tokens</code> file exists, and if it does, it reads each line, splits it into a key and a value, and adds it to a table named `env`. Finally, it returns that table.</p>

            <h2>Step 3: the result</h2>
            <p>That's it. Now, restart Vesper. The script runs once at startup. If you open a new pane while inside `my-project`, the `env.lua` script will find the <code>.tokens</code> file and automatically make `GITHUB_API_KEY` and `STRIPE_API_KEY` available as environment variables in that pane. If you open a pane in a different directory that doesn't have a <code>.tokens</code> file, nothing happens.</p>
            <p>You now have a secure, automated, and context-aware system for managing secrets, powered by Vesper's intelligent architecture.</p>
        </article>

        <p style="text-align: center; margin-top: 40px;">
            <strong>Ready to stop fighting your terminal?</strong><br>
            Install Vesper and experience a more modern, intuitive workflow.
        </p>
        <p style="text-align: center;">
            <a href="../docs/install.html" class="cta-button">Get Vesper Now</a>
        </p>

    </main>

    <footer>
        <p>&copy; 2025 Vesper.sh. Open Source under the MIT License.</p>
        <p><a href="https://github.com/cosminadrianpopescu/azul">GitHub</a> | <a href="../community.html">Community</a></p>
    </footer>
    <script>
        const menuToggle=document.querySelector(".menu-toggle"),body=document.body;menuToggle.addEventListener("click",()=>{body.classList.toggle("nav-open")}),document.querySelectorAll(".overlay-menu a").forEach(e=>{e.addEventListener("click",()=>{body.classList.remove("nav-open")})}),document.querySelectorAll(".copy-button").forEach(e=>{e.addEventListener("click",()=>{const o=e.parentElement.querySelector("pre");o&&navigator.clipboard.writeText(o.innerText).then(()=>{e.innerText="Copied!",setTimeout(()=>{e.innerText="Copy"},2e3)}).catch(o=>{console.error("Failed to copy text: ",o),e.innerText="Error"})})});
    </script>
</body>
</html>